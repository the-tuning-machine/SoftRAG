=== RAG Benchmark with Full Corpus Retrieval ===

Loading MultiHopRAG dataset (train)...
Loaded 434 examples
Built corpus with 470 unique documents

Train examples: 347
Test examples: 87
Corpus size: 470 documents

Creating RAG model...
Loading embedding model: all-MiniLM-L6-v2...
Loading cross-encoder: cross-encoder/ms-marco-MiniLM-L-6-v2...
Embedding corpus of 470 documents...
Corpus embedded: torch.Size([470, 384])
Trainable parameters: 97

=== Before Training (k=20) ===
  Evaluating 1/87
  Evaluating 11/87
  Evaluating 21/87
  Evaluating 31/87
  Evaluating 41/87
  Evaluating 51/87
  Evaluating 61/87
  Evaluating 71/87
  Evaluating 81/87

Evaluation Results:
Precision@20: 0.1236
Recall@20: 0.9234
MRR: 0.8424
NDCG@20: 0.7861

=== Training (k=20) ===
  Example 1/347
  Example 11/347
  Example 21/347
  Example 31/347
  Example 41/347
  Example 51/347
  Example 61/347
  Example 71/347
  Example 81/347
  Example 91/347
  Example 101/347
  Example 111/347
  Example 121/347
  Example 131/347
  Example 141/347
  Example 151/347
  Example 161/347
  Example 171/347
  Example 181/347
  Example 191/347
Traceback (most recent call last):
  File "/home/alan-tuning/Documents/Cours ENS/Geometric Data Analysis/fast-soft-sort/rag_bench/rag_benchmark_v2.py", line 491, in <module>
    main()
  File "/home/alan-tuning/Documents/Cours ENS/Geometric Data Analysis/fast-soft-sort/rag_bench/rag_benchmark_v2.py", line 474, in main
    train_rag_model(
  File "/home/alan-tuning/Documents/Cours ENS/Geometric Data Analysis/fast-soft-sort/rag_bench/rag_benchmark_v2.py", line 346, in train_rag_model
    loss.backward()
  File "/home/alan-tuning/Documents/Cours ENS/Geometric Data Analysis/fast-soft-sort/.venv/lib/python3.11/site-packages/torch/_tensor.py", line 625, in backward
    torch.autograd.backward(
  File "/home/alan-tuning/Documents/Cours ENS/Geometric Data Analysis/fast-soft-sort/.venv/lib/python3.11/site-packages/torch/autograd/__init__.py", line 354, in backward
    _engine_run_backward(
  File "/home/alan-tuning/Documents/Cours ENS/Geometric Data Analysis/fast-soft-sort/.venv/lib/python3.11/site-packages/torch/autograd/graph.py", line 841, in _engine_run_backward
    return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: element 0 of tensors does not require grad and does not have a grad_fn
